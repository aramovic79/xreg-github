name: GitHub Actions ApeiroRA OWS3
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
  ApeiroRA-OWS3-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub."
      - run: echo "🔎 The name of the branch is ${{ github.ref }} and repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "🖥️ The workflow is now ready to test the code on the runner."
      - name: List files in the repository
        run: |
          find ${{ github.workspace }} -type f
      - name: List test files
        run: |
          find . -name *_test.go -exec dirname {} \; | sort -u
      - name: Print current directory
        run: pwd
      - name: Check and install gardenctl
        run: |
          if ! command -v gardenctl &> /dev/null
          then
            echo "gardenctl could not be found, installing..."
            curl -Lo gardenctl https://github.com/gardener/gardenctl/releases/latest/download/gardenctl-linux-amd64
            chmod +x gardenctl
            sudo mv gardenctl /usr/local/bin/
          else
            echo "gardenctl is already installed"
          fi
      - name: Check and install make
        run: |
          if ! command -v make &> /dev/null
          then
            echo "make could not be found, installing..."
            sudo apt-get update
            sudo apt-get install -y make
          else
            echo "make is already installed"
          fi    
      - name: Run tests using make
        run: make tmptest
      - name: Build docker image using make
        run: make image
      - name: Push docker image using make
        run: make push
      - run: echo "🍏 This job's status is ${{ job.status }}."
      # - name: Set KUBECONFIG environment variable
      #   run: echo "export KUBECONFIG=.kube/kubeconfig-gardenlogin--ows3--ytdzgvnl69.yaml" >> $GITHUB_ENV
      # - name: Apply Kubernetes configuration
      #   run: kubectl apply -f misc/mysql.yaml  